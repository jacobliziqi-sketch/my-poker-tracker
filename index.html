<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PokerFlow 2.1 - 完整逻辑版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --poker-green: #1a4d2e; --poker-dark: #070b14; }
        body { background-color: var(--poker-dark); color: #f8fafc; font-family: -apple-system, system-ui; touch-action: manipulation; }
        .table-field { background: radial-gradient(circle at center, #246b41 0%, #0f331d 100%); border: 4px solid #2d1f1f; border-radius: 140px; height: 280px; position: relative; width: 100%; margin: 15px 0; box-shadow: inset 0 0 50px rgba(0,0,0,0.5); }
        .seat { position: absolute; transform: translate(-50%, -50%); width: 75px; text-align: center; cursor: pointer; }
        .avatar-ring { @apply w-12 h-12 rounded-full border-2 border-slate-700 bg-slate-900 flex items-center justify-center font-bold text-sm relative transition-all; }
        .active-seat .avatar-ring { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.6); transform: scale(1.1); }
        .btn-tag { @apply absolute -top-1 -right-1 w-5 h-5 bg-white text-black rounded-full text-[10px] flex items-center justify-center font-black border border-gray-400; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .force-tag { @apply absolute -bottom-1 left-1/2 -translate-x-1/2 px-1 bg-red-600 text-white text-[8px] rounded leading-tight font-bold; }
        .hud-vpip { font-size: 8px; @apply mt-1 px-1 rounded bg-black/40 text-emerald-400 font-mono; }
        .stack-info { font-size: 10px; @apply font-bold text-yellow-500 mt-0.5; }
        .action-btn { @apply flex-1 py-5 rounded-2xl font-black text-xs active:opacity-50 transition-all shadow-lg uppercase tracking-widest; }
    </style>
</head>
<body class="p-4 flex flex-col min-h-screen">

    <header class="flex justify-between items-end px-1 mb-2">
        <div onclick="openSessionMenu()">
            <h1 id="curSessionName" class="text-lg font-black text-blue-400 leading-tight">载入中...</h1>
            <p id="curBBInfo" class="text-[9px] text-slate-500 font-bold uppercase">SET BLINDS</p>
        </div>
        <div class="text-right">
            <span class="text-[10px] text-slate-500 font-bold uppercase block">Current Stage</span>
            <span id="handCounter" class="text-xs font-mono font-bold text-emerald-500 tracking-tighter">HAND #0</span>
        </div>
    </header>

    <main class="table-field shadow-2xl">
        <div id="seatsContainer"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-20">
            <i data-lucide="layers" class="w-12 h-12"></i>
        </div>
    </main>

    <section class="mt-auto space-y-3">
        <div class="flex gap-2">
            <button onclick="handleAction('Fold')" class="action-btn bg-slate-800 border border-slate-700">Fold</button>
            <button onclick="handleAction('Call')" class="action-btn bg-blue-600">Call</button>
            <button onclick="handleAction('Raise')" class="action-btn bg-emerald-600 text-black">Raise</button>
        </div>
        
        <div class="bg-slate-900 rounded-3xl p-4 border border-slate-800 flex items-center gap-3">
            <div class="flex-1">
                <p class="text-[9px] text-slate-500 font-bold ml-1 mb-1">本局盈亏 (金额)</p>
                <input id="inputProfit" type="number" placeholder="0.00" class="w-full bg-transparent text-2xl font-mono font-bold outline-none text-white">
            </div>
            <button onclick="submitRound()" class="h-14 px-8 bg-indigo-600 rounded-2xl font-black text-xs shadow-lg">SAVE</button>
        </div>
    </section>

    <div id="modalPlayer" class="fixed inset-0 bg-black/95 z-[100] p-6 hidden flex flex-col justify-center">
        <div class="flex justify-between mb-8">
            <h2 class="text-2xl font-black text-yellow-500">位置详情</h2>
            <button onclick="closeModals()"><i data-lucide="x"></i></button>
        </div>
        <div class="space-y-6 bg-slate-900 p-6 rounded-3xl border border-slate-800">
            <div>
                <label class="text-xs text-slate-500 font-bold mb-2 block uppercase">玩家昵称</label>
                <input id="inPlayerName" class="w-full bg-slate-950 p-4 rounded-xl text-xl font-bold border border-slate-700 outline-none">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-slate-500 font-bold mb-2 block uppercase">后手深度 (BB)</label>
                    <input id="inPlayerStack" type="number" class="w-full bg-slate-950 p-4 rounded-xl text-xl font-bold border border-slate-700 outline-none text-yellow-500">
                </div>
                <div class="flex flex-col justify-end">
                    <button onclick="setAsButton()" class="w-full h-[60px] bg-white text-black rounded-xl font-black text-xs">设为 BTN</button>
                </div>
            </div>
            <button onclick="savePlayerUpdate()" class="w-full bg-blue-600 py-4 rounded-2xl font-black mt-4 uppercase tracking-widest text-sm">确认更新</button>
        </div>
    </div>

    <div id="modalSession" class="fixed inset-0 bg-black/95 z-[100] p-6 hidden">
        <div class="flex justify-between mb-8"><h2 class="text-2xl font-black">场次管理</h2><button onclick="closeModals()"><i data-lucide="x"></i></button></div>
        <div class="bg-indigo-600/10 border border-indigo-500/30 p-5 rounded-3xl mb-6 space-y-3">
            <input id="inSessionName" placeholder="场次名称" class="w-full bg-slate-900 p-3 rounded-xl outline-none border border-slate-700">