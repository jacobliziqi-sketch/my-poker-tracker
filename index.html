<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PokerFlow HUD Pro - 盈利监控版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #070b14; color: #e2e8f0; font-family: -apple-system, sans-serif; overflow: hidden; }
        .poker-table { background: radial-gradient(circle, #1a4d2e 0%, #0a2615 100%); border: 6px solid #2d1f1f; border-radius: 160px; position: relative; height: 300px; width: 100%; margin: 15px 0; }
        .player-slot { position: absolute; transform: translate(-50%, -50%); text-align: center; width: 75px; }
        .avatar { @apply w-12 h-12 rounded-full border-2 border-slate-600 bg-slate-800 flex flex-col items-center justify-center text-[10px] font-bold transition-all active:scale-95; }
        .active-seat { border-color: #fbbf24; box-shadow: 0 0 15px #fbbf24; }
        .hud-box { font-size: 8px; @apply mt-1 bg-black/60 rounded px-1 py-0.5 text-emerald-400 font-mono shadow-sm; }
        .profit-tag { font-size: 9px; @apply font-bold mt-0.5; }
        .modal-bg { @apply fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-6 backdrop-blur-md; }
    </style>
</head>
<body class="p-4">
    <div class="flex justify-between items-center mb-2">
        <div>
            <span id="bbDisplay" class="text-[10px] bg-blue-600 px-2 py-0.5 rounded font-bold uppercase italic">1/2 BB</span>
            <span class="text-[10px] text-slate-500 ml-2">HAND #<span id="handNum">1</span></span>
        </div>
        <button onclick="showReport()" class="text-xs text-emerald-400 font-bold flex items-center gap-1">
            <i data-lucide="bar-chart-2" class="w-3 h-3"></i> 结束并导出报表
        </button>
    </div>

    <div class="poker-table shadow-2xl">
        <div id="tablePlayers"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none">
            <div id="potValue" class="text-3xl font-black text-yellow-500 font-mono">0</div>
            <div class="text-[8px] text-slate-400 uppercase tracking-widest">Live Session</div>
        </div>
    </div>

    <div class="grid grid-cols-3 gap-3 mb-4">
        <button onclick="recordAction('Fold')" class="py-4 rounded-xl bg-slate-700 font-black text-xs">FOLD</button>
        <button onclick="recordAction('Call')" class="py-4 rounded-xl bg-blue-600 font-black text-xs">CALL</button>
        <button onclick="recordAction('Raise')" class="py-4 rounded-xl bg-emerald-600 font-black text-xs text-black">RAISE</button>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-800">
            <label class="text-[8px] text-slate-500 uppercase font-bold">本局输赢 (金额)</label>
            <div class="flex gap-2 mt-1">
                <input id="roundProfit" type="number" placeholder="+/-" class="w-full bg-transparent text-xl font-mono outline-none text-white">
                <button onclick="nextHand()" class="bg-indigo-600 px-4 rounded-lg font-bold text-[10px]">SAVE</button>
            </div>
        </div>
        <div class="flex flex-col justify-between">
            <button onclick="toggleSettings()" class="bg-slate-800 p-2 rounded-lg text-[10px] text-center">⚙️ 盲注设置</button>
            <button onclick="if(confirm('重置所有数据？')) {localStorage.clear(); location.reload();}" class="text-slate-600 text-[8px] text-right">RESET DATA</button>
        </div>
    </div>

    <div id="reportModal" class="modal-bg">
        <div class="bg-slate-900 w-full rounded-3xl p-6 border border-slate-700 shadow-2xl max-h-[80vh] overflow-y-auto">
            <h3 class="text-xl font-black mb-4 text-emerald-400">SESSION REPORT</h3>
            <div id="reportList" class="space-y-4 mb-6 text-sm"></div>
            <button onclick="document.getElementById('reportModal').classList.add('hidden')" class="w-full bg-slate-700 py-3 rounded-xl font-bold">返回牌桌</button>
        </div>
    </div>

    <script>
        let config = JSON.parse(localStorage.getItem('poker_config')) || { bb: 2 };
        let seats = JSON.parse(localStorage.getItem('poker_seats')) || {
            'SB': {name: 'P1', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0},
            'BB': {name: 'P2', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0},
            'UTG': {name: 'P3', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0},
            'HJ': {name: 'P4', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0},
            'CO': {name: 'P5', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0},
            'BTN': {name: 'P6', profit: 0, vpip_count: 0, pfr_count: 0, total_hands: 0}
        };

        const layout = {
            'SB': {x: '50%', y: '88%'}, 'BB': {x: '20%', y: '80%'},
            'UTG': {x: '12%', y: '50%'}, 'HJ': {x: '30%', y: '18%'},
            'CO': {x: '70%', y: '18%'}, 'BTN': {x: '88%', y: '50%'}
        };

        let activeSeat = 'UTG';
        let handCount = parseInt(localStorage.getItem('hand_count') || '1');

        function render() {
            const container = document.getElementById('tablePlayers');
            container.innerHTML = '';
            for (let id in seats) {
                const p = seats[id];
                const vpip = p.total_hands > 0 ? Math.round((p.vpip_count / p.total_hands) * 100) : 0;
                const pfr = p.total_hands > 0 ? Math.round((p.pfr_count / p.total_hands) * 100) : 0;
                const bbProfit = (p.profit / config.bb).toFixed(1);

                container.innerHTML += `
                    <div class="player-slot" style="left:${layout[id].x}; top:${layout[id].y}" onclick="activeSeat='${id}';render();">
                        <div class="text-[8px] font-bold ${activeSeat === id ? 'text-yellow-400' : 'text-slate-600'}">${id}</div>
                        <div class="avatar ${activeSeat === id ? 'active-seat' : ''}">
                            <span class="text-white">${p.name}</span>
                            <span class="profit-tag ${p.profit >=0 ? 'text-emerald-400' : 'text-red-500'}">${bbProfit} BB</span>
                        </div>
                        <div class="hud-box">V:${vpip} P:${pfr}</div>
                    </div>
                `;
            }
            document.getElementById('handNum').innerText = handCount;
            document.getElementById('bbDisplay').innerText = `1/${config.bb} BB`;
            lucide.createIcons();
        }

        function recordAction(type) {
            const p = seats[activeSeat];
            p.total_hands++;
            if(type === 'Call') p.vpip_count++;
            if(type === 'Raise') { p.vpip_count++; p.pfr_count++; }
            
            // 自动轮转
            const order = ['SB', 'BB', 'UTG', 'HJ', 'CO', 'BTN'];
            activeSeat = order[(order.indexOf(activeSeat) + 1) % order.length];
            save();
            render();
        }

        function nextHand() {
            const profit = parseFloat(document.getElementById('roundProfit').value || 0);
            seats[activeSeat].profit += profit; // 记录当前亮起位置的盈亏
            handCount++;
            document.getElementById('roundProfit').value = '';
            save();
            render();
        }

        function showReport() {
            const modal = document.getElementById('reportModal');
            const list = document.getElementById('reportList');
            modal.classList.remove('hidden');
            
            let html = `<div class="grid grid-cols-4 font-bold text-slate-500 border-b border-slate-700 pb-2 text-[10px]">
                <span>玩家</span><span>入池VPIP</span><span>激进PFR</span><span>总盈亏</span>
            </div>`;
            
            for(let id in seats) {
                const p = seats[id];
                const v = p.total_hands > 0 ? Math.round((p.vpip_count / p.total_hands)*100) : 0;
                const r = p.total_hands > 0 ? Math.round((p.pfr_count / p.total_hands)*100) : 0;
                html += `<div class="grid grid-cols-4 py-2 border-b border-slate-800 items-center text-xs">
                    <span class="font-bold">${p.name}</span>
                    <span class="${v > 30 ? 'text-yellow-400' : ''}">${v}%</span>
                    <span>${r}%</span>
                    <span class="font-mono ${p.profit >=0 ? 'text-emerald-400' : 'text-red-500'}">${p.profit}</span>
                </div>`;
            }
            list.innerHTML = html;
        }

        function toggleSettings() {
            const newBB = prompt("设置大盲金额 (如输入 2 代表 1/2):", config.bb);
            if(newBB) {
                config.bb = parseInt(newBB);
                localStorage.setItem('poker_config', JSON.stringify(config));
                render();
            }
        }

        function save() {
            localStorage.setItem('poker_seats', JSON.stringify(seats));
            localStorage.setItem('hand_count', handCount);
        }

        render();
    </script>
</body>
</html>